<!DOCTYPE html>
<html>
  <head>
    <title>Mockup Tools & Etsy Integration</title>
    <style>
      :root {
        --bg-color: #1e1e1e;
        --container-bg: #2d2d2d;
        --text-color: #e0e0e0;
        --border-color: #444;
        --input-bg: #3d3d3d;
        --input-text: #e0e0e0;
        --primary-color: #6200ee;
        --primary-hover: #7c4dff;
        --secondary-color: #03dac6;
        --error-color: #cf6679;
        --success-color: #4caf50;
        --log-bg: #2a2a2a;
        --section-bg: #333;
        --tab-bg: #3d3d3d;
        --tab-active-bg: #6200ee;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: var(--bg-color);
        color: var(--text-color);
        line-height: 1.6;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        background-color: var(--container-bg);
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      }

      h1,
      h2,
      h3 {
        color: var(--secondary-color);
      }

      .tabs {
        display: flex;
        margin-bottom: 20px;
        border-bottom: 1px solid var(--border-color);
      }

      .tab {
        padding: 12px 24px;
        cursor: pointer;
        background-color: var(--tab-bg);
        margin-right: 5px;
        border-radius: 8px 8px 0 0;
        border: none;
        color: var(--text-color);
        font-weight: 500;
        transition: background-color 0.2s, color 0.2s;
      }

      .tab:hover {
        background-color: #4a4a4a;
      }

      .tab.active {
        background-color: var(--tab-active-bg);
        color: white;
      }

      .tab-content {
        display: none;
        padding: 20px;
        border: 1px solid var(--border-color);
        border-radius: 0 0 8px 8px;
        background-color: var(--section-bg);
      }

      .tab-content.active {
        display: block;
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--secondary-color);
      }

      input[type="text"],
      select,
      textarea {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        box-sizing: border-box;
        background-color: var(--input-bg);
        color: var(--input-text);
        font-family: inherit;
        transition: border-color 0.2s;
      }

      input[type="text"]:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(98, 0, 238, 0.2);
      }

      button {
        background-color: var(--primary-color);
        color: white;
        padding: 12px 18px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        margin-right: 10px;
        font-weight: 500;
        transition: background-color 0.2s, transform 0.1s;
      }

      button:hover {
        background-color: var(--primary-hover);
      }

      .secondary-button {
        background-color: var(--section-bg);
        border: 1px solid var(--secondary-color);
        color: var(--secondary-color);
      }

      .secondary-button:hover {
        background-color: var(--secondary-color);
        color: var(--bg-color);
      }

      .highlight-update {
        animation: highlight-fade 2s ease-in-out;
      }

      @keyframes highlight-fade {
        0% { background-color: rgba(3, 218, 198, 0.3); }
        100% { background-color: transparent; }
      }

      button:active {
        transform: translateY(1px);
      }

      .log-area {
        margin-top: 20px;
        padding: 15px;
        background-color: var(--log-bg);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        height: 200px;
        overflow-y: auto;
        font-family: "Consolas", "Courier New", monospace;
        color: #ddd;
      }

      .section {
        margin-bottom: 25px;
        padding: 20px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        background-color: var(--section-bg);
      }

      .actions {
        margin-top: 20px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      /* Success message styling */
      #auth-status {
        color: var(--success-color) !important;
        font-weight: 500;
        margin-top: 10px;
      }

      /* Checkbox styling */
      input[type="checkbox"] {
        accent-color: var(--primary-color);
        width: 18px;
        height: 18px;
        vertical-align: middle;
      }

      /* Counter and validation styling */
      .counter {
        font-size: 0.8em;
        margin-left: 8px;
        color: var(--text-color);
      }

      .counter.warning {
        color: orange;
      }

      .counter.error {
        color: var(--error-color);
      }

      .validation-message {
        font-size: 0.85em;
        margin-top: 4px;
        min-height: 1.2em;
      }

      .validation-message.error {
        color: var(--error-color);
      }

      .validation-message.warning {
        color: orange;
      }

      /* Log section styling */
      .log-section {
        margin-top: 30px;
      }

      .log-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .log-title {
        margin: 0;
        font-size: 1.2em;
      }

      .log-controls {
        display: flex;
        gap: 10px;
      }

      .log-button {
        padding: 8px 12px;
        font-size: 0.85em;
      }

      .log-button.active {
        background-color: var(--secondary-color);
      }

      .log-area {
        padding: 15px;
        background-color: var(--log-bg);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        height: 300px;
        overflow-y: auto;
        font-family: 'JetBrains Mono', 'Fira Code', 'SF Mono', 'Roboto Mono', 'Ubuntu Mono', 'Menlo', 'Consolas', 'Courier New', monospace;
        font-size: 0.9em;
        line-height: 1.6;
        color: #ddd;
        white-space: pre-wrap;
        word-break: break-word;
      }

      .log-entry {
        margin-bottom: 6px;
        padding-bottom: 6px;
        border-bottom: 1px dotted rgba(255, 255, 255, 0.1);
      }

      .log-entry.command {
        color: var(--secondary-color);
        font-weight: bold;
      }

      .log-entry.error {
        color: var(--error-color);
      }

      .log-entry.success {
        color: var(--success-color);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Mockup Tools & Etsy Integration</h1>

      <div class="tabs">
        <button class="tab active" id="pattern-tab">Pattern</button>
        <button class="tab" id="clipart-tab">Clipart</button>
        <button class="tab" id="etsy-tab">Etsy</button>
      </div>

      <div id="pattern" class="tab-content active">
        <h2>Pattern Tools</h2>

        <div class="section">
          <h3>Input Directory</h3>
          <div class="form-group">
            <label for="pattern-input-dir">Input Directory:</label>
            <input
              type="text"
              id="pattern-input-dir"
              name="pattern-input-dir"
              value="input"
            />
          </div>

          <div class="actions">
            <button onclick="runPatternWorkflow()">
              Run Complete Workflow
            </button>
            <button onclick="runPatternResize()">Resize Only</button>
            <button onclick="runPatternMockups()">Create Mockups Only</button>
          </div>
        </div>
      </div>

      <div id="clipart" class="tab-content">
        <h2>Clipart Tools</h2>

        <div class="section">
          <h3>Input Directory</h3>
          <div class="form-group">
            <label for="clipart-input-dir">Input Directory:</label>
            <input
              type="text"
              id="clipart-input-dir"
              name="clipart-input-dir"
              value="input"
            />
          </div>

          <div class="actions">
            <button onclick="runClipartWorkflow()">
              Run Complete Workflow
            </button>
            <button onclick="runClipartResize()">Resize Only</button>
            <button onclick="runClipartMockups()">Create Mockups Only</button>
          </div>
        </div>
      </div>

      <div id="etsy" class="tab-content">
        <h2>Etsy Integration</h2>

        <div class="section">
          <h3>Authentication</h3>
          <button id="auth-button" onclick="authenticateEtsy()">
            Authenticate with Etsy
          </button>
          <div id="auth-status" style="color: green; margin-top: 10px"></div>
        </div>

        <div class="section">
          <h3>Create Single Listing</h3>
          <div class="form-group">
            <label for="etsy-subfolder">Select Subfolder from 'input':</label>
            <select id="etsy-subfolder" name="etsy-subfolder">
              <option value="">-- Select a subfolder --</option>
              <!-- Will be populated dynamically -->
            </select>
            <button onclick="refreshSubfolders()" style="margin-top: 5px">
              Refresh Subfolders
            </button>
          </div>

          <div class="form-group">
            <label for="etsy-product-type">Product Type:</label>
            <select id="etsy-product-type" name="etsy-product-type">
              <option value="pattern">Pattern</option>
              <option value="clipart">Clipart</option>
              <option value="wall_art">Wall Art</option>
              <option value="brush_strokes">Brush Strokes</option>
            </select>
          </div>

          <div class="form-group">
            <label for="etsy-title">Title: <span id="title-counter" class="counter">0/140</span></label>
            <input
              type="text"
              id="etsy-title"
              name="etsy-title"
              placeholder="Enter listing title (max 140 characters)"
              oninput="updateTitleCounter()"
            />
            <div id="title-validation" class="validation-message"></div>
          </div>

          <div class="form-group">
            <label for="etsy-description">Description:</label>
            <textarea
              id="etsy-description"
              name="etsy-description"
              rows="5"
              style="
                width: 100%;
                padding: 8px;
                border: 1px solid #ddd;
                border-radius: 4px;
                box-sizing: border-box;
              "
              placeholder="Enter listing description"
            ></textarea>
          </div>

          <div class="form-group">
            <label for="etsy-tags">Tags (comma separated): <span id="tags-counter" class="counter">0/13</span></label>
            <input
              type="text"
              id="etsy-tags"
              name="etsy-tags"
              placeholder="tag1, tag2, tag3 (max 13 tags, each max 20 chars)"
              oninput="updateTagsCounter()"
            />
            <div id="tags-validation" class="validation-message"></div>
          </div>
          </div>

          <div class="form-group">
            <input type="checkbox" id="etsy-draft" name="etsy-draft" checked />
            <label for="etsy-draft" style="display: inline"
              >Create as Draft</label
            >
          </div>

          <div class="actions">
            <button onclick="generateEtsyListing()" class="secondary-button">Generate Listing Content</button>
            <button onclick="createEtsyListing()">Create Listing</button>
          </div>
        </div>
      </div>

      <div class="section log-section">
        <div class="log-header">
          <h3 class="log-title">Command Log</h3>
          <div class="log-controls">
            <button onclick="clearLog()" class="log-button">Clear Log</button>
            <button onclick="toggleAutoScroll()" id="autoscroll-button" class="log-button active">Auto-scroll: ON</button>
          </div>
        </div>
        <div class="log-area" id="log"></div>
      </div>
    </div>

    <script>
      // Title counter and validation
      function updateTitleCounter() {
        const titleInput = document.getElementById("etsy-title");
        const titleCounter = document.getElementById("title-counter");
        const titleValidation = document.getElementById("title-validation");
        const maxLength = 140;
        const currentLength = titleInput.value.length;

        // Update counter
        titleCounter.textContent = `${currentLength}/${maxLength}`;

        // Update counter class
        titleCounter.className = "counter";
        if (currentLength > maxLength * 0.8 && currentLength <= maxLength) {
          titleCounter.classList.add("warning");
        } else if (currentLength > maxLength) {
          titleCounter.classList.add("error");
        }

        // Update validation message
        titleValidation.textContent = "";
        titleValidation.className = "validation-message";
        if (currentLength > maxLength) {
          titleValidation.textContent = `Title is too long by ${currentLength - maxLength} characters.`;
          titleValidation.classList.add("error");
        }
      }

      // Tags counter and validation
      function updateTagsCounter() {
        const tagsInput = document.getElementById("etsy-tags");
        const tagsCounter = document.getElementById("tags-counter");
        const tagsValidation = document.getElementById("tags-validation");
        const maxTags = 13;
        const maxTagLength = 20;

        // Process tags
        const tags = tagsInput.value
          .split(",")
          .map((tag) => tag.trim())
          .filter((tag) => tag.length > 0);

        // Update counter
        tagsCounter.textContent = `${tags.length}/${maxTags}`;

        // Update counter class
        tagsCounter.className = "counter";
        if (tags.length > maxTags * 0.8 && tags.length <= maxTags) {
          tagsCounter.classList.add("warning");
        } else if (tags.length > maxTags) {
          tagsCounter.classList.add("error");
        }

        // Check for long tags
        const longTags = tags.filter((tag) => tag.length > maxTagLength);

        // Update validation message
        tagsValidation.textContent = "";
        tagsValidation.className = "validation-message";

        if (tags.length > maxTags) {
          tagsValidation.textContent = `Too many tags (${tags.length}/${maxTags}). Please remove ${tags.length - maxTags} tag(s).`;
          tagsValidation.classList.add("error");
        } else if (longTags.length > 0) {
          tagsValidation.textContent = `${longTags.length} tag(s) exceed the 20 character limit: ${longTags.join(", ")}`;
          tagsValidation.classList.add("error");
        }
      }

      // Add event listeners to tab buttons
      document.addEventListener("DOMContentLoaded", function () {
        // Pattern tab
        document
          .getElementById("pattern-tab")
          .addEventListener("click", function () {
            showTab("pattern");
          });

        // Clipart tab
        document
          .getElementById("clipart-tab")
          .addEventListener("click", function () {
            showTab("clipart");
          });

        // Etsy tab
        document
          .getElementById("etsy-tab")
          .addEventListener("click", function () {
            showTab("etsy");
            // Refresh subfolders when switching to Etsy tab
            refreshSubfolders();
            // Initialize counters
            updateTitleCounter();
            updateTagsCounter();
          });

        // Check for authentication status
        checkLogForAuthStatus();

        // Initial refresh of subfolders
        refreshSubfolders();

        // Initialize counters
        updateTitleCounter();
        updateTagsCounter();
      });

      // Function to show a tab
      function showTab(tabId) {
        console.log("Showing tab:", tabId);

        // Hide all tab contents
        document.querySelectorAll(".tab-content").forEach((tab) => {
          tab.classList.remove("active");
        });

        // Show selected tab content
        document.getElementById(tabId).classList.add("active");

        // Update tab buttons
        document.querySelectorAll(".tab").forEach((tab) => {
          tab.classList.remove("active");
        });

        // Activate the correct tab button
        document.getElementById(tabId + "-tab").classList.add("active");
      }

      // Auto-scroll state
      let autoScroll = true;

      // Toggle auto-scroll
      function toggleAutoScroll() {
        autoScroll = !autoScroll;
        const button = document.getElementById('autoscroll-button');
        if (autoScroll) {
          button.textContent = 'Auto-scroll: ON';
          button.classList.add('active');
          // Scroll to bottom immediately when turning on
          const logArea = document.getElementById('log');
          logArea.scrollTop = logArea.scrollHeight;
        } else {
          button.textContent = 'Auto-scroll: OFF';
          button.classList.remove('active');
        }
      }

      // Format log message with timestamp
      function formatLogMessage(message) {
        const now = new Date();
        const timestamp = now.toLocaleTimeString();
        let cssClass = 'log-entry';

        // Add specific styling based on message content
        if (message.includes('Command submitted:') || message.includes('Running command:')) {
          cssClass += ' command';
        } else if (message.includes('Error') || message.includes('failed')) {
          cssClass += ' error';
        } else if (message.includes('successfully') || message.includes('Authentication successful')) {
          cssClass += ' success';
        }

        return `<div class="${cssClass}">[${timestamp}] ${message}</div>`;
      }

      // Log message
      function log(message) {
        const logArea = document.getElementById("log");
        logArea.innerHTML += formatLogMessage(message);

        // Only auto-scroll if enabled
        if (autoScroll) {
          logArea.scrollTop = logArea.scrollHeight;
        }
      }

      // Clear log
      function clearLog() {
        document.getElementById("log").innerHTML = "";
      }

      // Check for new log messages
      function checkLog() {
        fetch("/log")
          .then((response) => response.json())
          .then((data) => {
            if (data.messages && data.messages.length > 0) {
              data.messages.forEach((message) => {
                log(message);
              });
            }

            // Check again in 1 second
            setTimeout(checkLog, 1000);
          })
          .catch((error) => {
            console.error("Error checking log:", error);
            // Try again in 5 seconds
            setTimeout(checkLog, 5000);
          });
      }

      // Start checking for log messages
      checkLog();

      // Check for authentication status in log messages
      function checkLogForAuthStatus() {
        const logArea = document.getElementById("log");
        const logText = logArea.innerHTML;
        const authStatusDiv = document.getElementById("auth-status");
        const authButton = document.getElementById("auth-button");

        // Check if log contains authentication success messages
        if (
          logText.includes("Already authenticated with Etsy") ||
          logText.includes("Authentication successful")
        ) {
          // Show success message and disable button
          authStatusDiv.innerHTML = "âœ“ Already authenticated with Etsy";
          authButton.disabled = true;
        } else {
          // Clear success message and enable button
          authStatusDiv.innerHTML = "";
          authButton.disabled = false;
        }
      }

      // Set up a MutationObserver to watch for changes to the log
      const logArea = document.getElementById("log");
      const observer = new MutationObserver(function (mutations) {
        checkLogForAuthStatus();
      });
      observer.observe(logArea, { childList: true });

      // Pattern actions
      function runPatternWorkflow() {
        fetch("/run", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            command: "pattern-workflow",
            inputDir: document.getElementById("pattern-input-dir").value,
            createVideo: true,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            log("Command submitted: " + data.command);
          });
      }

      function runPatternResize() {
        fetch("/run", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            command: "pattern-resize",
            inputDir: document.getElementById("pattern-input-dir").value,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            log("Command submitted: " + data.command);
          });
      }

      function runPatternMockups() {
        fetch("/run", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            command: "pattern-mockups",
            inputDir: document.getElementById("pattern-input-dir").value,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            log("Command submitted: " + data.command);
          });
      }

      // Clipart actions
      function runClipartWorkflow() {
        fetch("/run", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            command: "clipart-workflow",
            inputDir: document.getElementById("clipart-input-dir").value,
            createVideo: true,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            log("Command submitted: " + data.command);
          });
      }

      function runClipartResize() {
        fetch("/run", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            command: "clipart-resize",
            inputDir: document.getElementById("clipart-input-dir").value,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            log("Command submitted: " + data.command);
          });
      }

      function runClipartMockups() {
        fetch("/run", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            command: "clipart-mockups",
            inputDir: document.getElementById("clipart-input-dir").value,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            log("Command submitted: " + data.command);
          });
      }

      // Etsy actions
      function authenticateEtsy() {
        fetch("/run", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            command: "etsy-auth",
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            log("Command submitted: " + data.command);
            // Check auth status after a delay to allow the command to complete
            setTimeout(checkLogForAuthStatus, 3000);
          });
      }

      // Function to refresh the list of subfolders in the input directory
      function refreshSubfolders() {
        fetch("/get-subfolders")
          .then((response) => response.json())
          .then((data) => {
            const select = document.getElementById("etsy-subfolder");

            // Save the current selection if any
            const currentSelection = select.value;

            // Clear all options except the first one
            while (select.options.length > 1) {
              select.remove(1);
            }

            // Add new options
            data.subfolders.forEach((subfolder) => {
              const option = document.createElement("option");
              option.value = subfolder;
              option.text = subfolder;
              select.add(option);
            });

            // Restore selection if it still exists
            if (data.subfolders.includes(currentSelection)) {
              select.value = currentSelection;
            }

            log(
              "Refreshed subfolders list: " +
                data.subfolders.length +
                " folders found"
            );
          })
          .catch((error) => {
            console.error("Error refreshing subfolders:", error);
            log("Error refreshing subfolders: " + error);
          });
      }

      function generateEtsyListing() {
        const subfolder = document.getElementById("etsy-subfolder").value;
        const productType = document.getElementById("etsy-product-type").value;

        // Validate inputs
        if (!subfolder) {
          alert("Please select a subfolder from the input directory.");
          return;
        }

        // Construct the full folder path
        const folder = "input/" + subfolder;

        // Show loading message
        log("Generating listing content for " + subfolder + "...");

        // Disable the button and show loading state
        const generateButton = document.querySelector(".actions button.secondary-button");
        const originalText = generateButton.textContent;
        generateButton.disabled = true;
        generateButton.textContent = "Generating...";

        // Call the API to generate content
        fetch("/run", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            command: "etsy-generate",
            folder: folder,
            productType: productType,
          }),
        })
          .then((response) => {
            if (!response.ok) {
              return response.json().then(data => {
                throw new Error(data.error || 'An error occurred');
              });
            }
            return response.json();
          })
          .then((data) => {
            log("Content generation completed.");

            // If content is returned directly, update the form fields
            if (data.content) {
              // Log the content for debugging
              console.log("Content received from server:", data.content);
              log("Content received from server - Title length: " + (data.content.title ? data.content.title.length : 0) +
                  ", Description length: " + (data.content.description ? data.content.description.length : 0) +
                  ", Tags count: " + (data.content.tags ? data.content.tags.length : 0));

              // Update the form fields
              document.getElementById("etsy-title").value = data.content.title || "";
              document.getElementById("etsy-description").value = data.content.description || "";
              document.getElementById("etsy-tags").value = (data.content.tags || []).join(", ");

              // Update counters
              updateTitleCounter();
              updateTagsCounter();

              log("Listing content applied to form fields.");

              // Highlight the fields that were updated
              const titleField = document.getElementById("etsy-title");
              const descriptionField = document.getElementById("etsy-description");
              const tagsField = document.getElementById("etsy-tags");

              // Add a temporary highlight class
              titleField.classList.add("highlight-update");
              descriptionField.classList.add("highlight-update");
              tagsField.classList.add("highlight-update");

              // Remove the highlight after a delay
              setTimeout(() => {
                titleField.classList.remove("highlight-update");
                descriptionField.classList.remove("highlight-update");
                tagsField.classList.remove("highlight-update");
              }, 2000);
            }
          })
          .catch((error) => {
            alert(error.message);
            log("Error: " + error.message);
          })
          .finally(() => {
            // Re-enable the button and restore text
            generateButton.disabled = false;
            generateButton.textContent = originalText;
          });
      }

      function createEtsyListing() {
        const subfolder = document.getElementById("etsy-subfolder").value;
        const productType = document.getElementById("etsy-product-type").value;
        const title = document.getElementById("etsy-title").value;
        const description = document.getElementById("etsy-description").value;
        const tagsInput = document.getElementById("etsy-tags").value;
        const draft = document.getElementById("etsy-draft").checked;

        // Validate inputs
        if (!subfolder) {
          alert("Please select a subfolder from the input directory.");
          return;
        }

        // Validate title length (max 140 characters)
        if (title.length > 140) {
          alert(
            `Title is too long (${title.length} characters). Etsy allows a maximum of 140 characters.`
          );
          return;
        }

        // Process tags - split by comma and trim whitespace
        const tags = tagsInput
          .split(",")
          .map((tag) => tag.trim())
          .filter((tag) => tag.length > 0);

        // Validate tags (max 13 for Etsy)
        if (tags.length > 13) {
          alert(
            "Etsy allows a maximum of 13 tags. Please reduce the number of tags."
          );
          return;
        }

        // Validate individual tag length (max 20 characters each)
        const longTags = tags.filter((tag) => tag.length > 20);
        if (longTags.length > 0) {
          alert(
            `The following tags are too long (max 20 characters each): ${longTags.join(
              ", "
            )}`
          );
          return;
        }

        // Construct the full folder path
        const folder = "input/" + subfolder;

        fetch("/run", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            command: "etsy-create",
            folder: folder,
            productType: productType,
            title: title,
            description: description,
            tags: tags,
            draft: draft,
          }),
        })
          .then((response) => {
            if (!response.ok) {
              return response.json().then(data => {
                throw new Error(data.error || 'An error occurred');
              });
            }
            return response.json();
          })
          .then((data) => {
            log("Command submitted: " + data.command);
          })
          .catch((error) => {
            alert(error.message);
            log("Error: " + error.message);
          });
      }
    </script>
  </body>
</html>
